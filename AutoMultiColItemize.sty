%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% itemize in automatic multi columns
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{etoolbox,refcount}
\newcounter{countitems}
\newcounter{nextitemizecount}
\newcommand{\setupcountitems}{%
  \stepcounter{nextitemizecount}%
  \setcounter{countitems}{0}%
  \preto\item{\stepcounter{countitems}}%
}
\makeatletter
\newcommand{\computecountitems}{%
  \edef\@currentlabel{\number\c@countitems}%
  \label{countitems@\number\numexpr\value{nextitemizecount}-1\relax}%
}
\newcommand{\nextitemizecount}{%
  \getrefnumber{countitems@\number\c@nextitemizecount}%
}
\newcommand{\previtemizecount}{%
  \getrefnumber{countitems@\number\numexpr\value{nextitemizecount}-1\relax}%
}
\makeatother    
\newenvironment{AutoMultiColItemize}{%
\ifnumcomp{\nextitemizecount}{>}{3}{
  \def\columnseprulecolor{\color{black}}
  \setlength{\columnseprule}{0.4pt}
  \begin{multicols}{2}}{}%
\setupcountitems\begin{itemize}}%
{\end{itemize}%
\unskip\computecountitems\ifnumcomp{\previtemizecount}{>}{3}{\end{multicols}}{}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% enumerate in multi columns
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcounter{countenums}
\newcounter{nextenumeratecount}
\newcommand{\setupcountenums}{%
  \stepcounter{nextenumeratecount}%
  \setcounter{countenums}{0}%
  \preto\item{\stepcounter{countenums}}%
}
\makeatletter
\newcommand{\computecountenums}{%
  \edef\@currentlabel{\number\c@countenums}%
  \label{countenums@\number\numexpr\value{nextenumeratecount}-1\relax}%
}
\newcommand{\nextenumeratecount}{%
  \getrefnumber{countenums@\number\c@nextenumeratecount}%
}
\newcommand{\prevenumeratecount}{%
  \getrefnumber{countenums@\number\numexpr\value{nextenumeratecount}-1\relax}%
}
\makeatother    
\newenvironment{AutoMultiColEnumerate}{%
\ifnumcomp{\nextenumeratecount}{>}{3}{
  \def\columnseprulecolor{\color{black}}
  \setlength{\columnseprule}{0.4pt}
\begin{multicols}{2}}{}%
\setupcountenums\begin{enumerate}}%
{\end{enumerate}%
\unskip\computecountenums\ifnumcomp{\prevenumeratecount}{>}{3}{\end{multicols}}{}}
